\hypertarget{slew_8c}{}\section{src/slew.c File Reference}
\label{slew_8c}\index{src/slew.\+c@{src/slew.\+c}}
{\ttfamily \#include \char`\"{}slew.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}log.\+h\char`\"{}}\newline
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{slew_8c_a981c9990a969d2587e66e550737f7cd9}{deinitslew} ()
\begin{DoxyCompactList}\small\item\em Deinitializes the slew rate controller and frees memory. \end{DoxyCompactList}\item 
void \hyperlink{slew_8c_a321758941d88b75783955c819bb75005}{init\+\_\+slew} ()
\begin{DoxyCompactList}\small\item\em Initializes the slew rate controller. \end{DoxyCompactList}\item 
void \hyperlink{slew_8c_a7dff2b79dffe55fb936d977594d7c01d}{set\+\_\+motor\+\_\+slew} (int motor, int speed)
\begin{DoxyCompactList}\small\item\em Sets motor speed wrapped inside the slew rate controller. \end{DoxyCompactList}\item 
void \hyperlink{slew_8c_a807a87c5df438fde21c1e8213906695b}{update\+Motors} ()
\begin{DoxyCompactList}\small\item\em Closes the distance between the desired motor value and the current motor value by half for each motor. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static bool \hyperlink{slew_8c_aedeffc7d23da25d52b9a50045189fe2b}{initialized} = false
\begin{DoxyCompactList}\small\item\em Boolean indicating whether or not the slew rate controller has been initialized. \end{DoxyCompactList}\item 
static signed char $\ast$ \hyperlink{slew_8c_a3143c164339fd92b9b1e132c63a41060}{motors\+\_\+set\+\_\+speeds} = N\+U\+LL
\begin{DoxyCompactList}\small\item\em Array of motor speed values to set the motors to. \end{DoxyCompactList}\item 
static Mutex \hyperlink{slew_8c_ae8b85b4f519a4945ba9ea43e9b503531}{mutex}
\begin{DoxyCompactList}\small\item\em mutex to protect the data in the array of speeds from being read or written to simultaneously. \end{DoxyCompactList}\item 
static Task\+Handle \hyperlink{slew_8c_a9dc30877eadbb32ceb6bede027c9a93f}{slew} = N\+U\+LL
\begin{DoxyCompactList}\small\item\em Task that will handle updating the motors on a routine period. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{slew_8c_a981c9990a969d2587e66e550737f7cd9}\label{slew_8c_a981c9990a969d2587e66e550737f7cd9}} 
\index{slew.\+c@{slew.\+c}!deinitslew@{deinitslew}}
\index{deinitslew@{deinitslew}!slew.\+c@{slew.\+c}}
\subsubsection{\texorpdfstring{deinitslew()}{deinitslew()}}
{\footnotesize\ttfamily void deinitslew (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Deinitializes the slew rate controller and frees memory. 

\begin{DoxyAuthor}{Author}
Chris Jerrett 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
9/14/17 
\end{DoxyDate}


Definition at line 62 of file slew.\+c.



References motors\+\_\+set\+\_\+speeds, and slew.


\begin{DoxyCode}
62                  \{
63   free(\hyperlink{slew_8c_a3143c164339fd92b9b1e132c63a41060}{motors\_set\_speeds});
64   taskDelete(\hyperlink{slew_8c_a9dc30877eadbb32ceb6bede027c9a93f}{slew});
65 \}
\end{DoxyCode}
\mbox{\Hypertarget{slew_8c_a321758941d88b75783955c819bb75005}\label{slew_8c_a321758941d88b75783955c819bb75005}} 
\index{slew.\+c@{slew.\+c}!init\+\_\+slew@{init\+\_\+slew}}
\index{init\+\_\+slew@{init\+\_\+slew}!slew.\+c@{slew.\+c}}
\subsubsection{\texorpdfstring{init\+\_\+slew()}{init\_slew()}}
{\footnotesize\ttfamily void init\+\_\+slew (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Initializes the slew rate controller. 

\begin{DoxyAuthor}{Author}
Chris Jerrett, Christian De\+Simone 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
9/14/17 
\end{DoxyDate}


Definition at line 49 of file slew.\+c.



References calloc\+\_\+real(), info(), initialized, M\+O\+T\+O\+R\+\_\+\+P\+O\+R\+TS, mutex, slew, U\+P\+D\+A\+T\+E\+\_\+\+P\+E\+R\+I\+O\+D\+\_\+\+MS, and update\+Motors().



Referenced by initialize().


\begin{DoxyCode}
49                 \{
50   \hyperlink{log_8h_a1606d750e1bb8de9f9e917172bba3382}{info}(\textcolor{stringliteral}{"Init Slew"});
51   \hyperlink{vlib_8h_a1115803c6996aebfbf67434810df7b4b}{calloc\_real}(\hyperlink{slew_8h_ad1ad4b29af4180aa00713599367fbc98}{MOTOR\_PORTS}, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char}));
52   \hyperlink{slew_8c_ae8b85b4f519a4945ba9ea43e9b503531}{mutex} = mutexCreate();
53   \hyperlink{slew_8c_a9dc30877eadbb32ceb6bede027c9a93f}{slew} = taskRunLoop(\hyperlink{slew_8c_a807a87c5df438fde21c1e8213906695b}{updateMotors}, \hyperlink{slew_8h_a4e8e7d6fdd1f5c6f8a0f341e4b61f025}{UPDATE\_PERIOD\_MS});
54   \hyperlink{slew_8c_aedeffc7d23da25d52b9a50045189fe2b}{initialized} = \textcolor{keyword}{true};
55 \}
\end{DoxyCode}
\mbox{\Hypertarget{slew_8c_a7dff2b79dffe55fb936d977594d7c01d}\label{slew_8c_a7dff2b79dffe55fb936d977594d7c01d}} 
\index{slew.\+c@{slew.\+c}!set\+\_\+motor\+\_\+slew@{set\+\_\+motor\+\_\+slew}}
\index{set\+\_\+motor\+\_\+slew@{set\+\_\+motor\+\_\+slew}!slew.\+c@{slew.\+c}}
\subsubsection{\texorpdfstring{set\+\_\+motor\+\_\+slew()}{set\_motor\_slew()}}
{\footnotesize\ttfamily void set\+\_\+motor\+\_\+slew (\begin{DoxyParamCaption}\item[{int}]{motor,  }\item[{int}]{speed }\end{DoxyParamCaption})}



Sets motor speed wrapped inside the slew rate controller. 


\begin{DoxyParams}{Parameters}
{\em motor} & the motor port to use \\
\hline
{\em speed} & the speed to use, between -\/127 and 127 \\
\hline
\end{DoxyParams}
\begin{DoxyAuthor}{Author}
Chris Jerrett 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
9/14/17 
\end{DoxyDate}


Definition at line 67 of file slew.\+c.



References motors\+\_\+set\+\_\+speeds, and mutex.



Referenced by operator\+Control().


\begin{DoxyCode}
67                                          \{
68   \textcolor{keywordflow}{if}(mutexTake(\hyperlink{slew_8c_ae8b85b4f519a4945ba9ea43e9b503531}{mutex}, 100)) \{
69       \hyperlink{slew_8c_a3143c164339fd92b9b1e132c63a41060}{motors\_set\_speeds}[motor] = speed;
70       mutexGive(\hyperlink{slew_8c_ae8b85b4f519a4945ba9ea43e9b503531}{mutex});
71   \}
72 \}
\end{DoxyCode}
\mbox{\Hypertarget{slew_8c_a807a87c5df438fde21c1e8213906695b}\label{slew_8c_a807a87c5df438fde21c1e8213906695b}} 
\index{slew.\+c@{slew.\+c}!update\+Motors@{update\+Motors}}
\index{update\+Motors@{update\+Motors}!slew.\+c@{slew.\+c}}
\subsubsection{\texorpdfstring{update\+Motors()}{updateMotors()}}
{\footnotesize\ttfamily void update\+Motors (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Closes the distance between the desired motor value and the current motor value by half for each motor. 

\begin{DoxyAuthor}{Author}
Chris Jerrett 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
9/14/17 
\end{DoxyDate}


Definition at line 31 of file slew.\+c.



References debug(), M\+O\+T\+O\+R\+\_\+\+P\+O\+R\+TS, motors\+\_\+set\+\_\+speeds, mutex, and R\+A\+M\+P\+\_\+\+P\+R\+O\+P\+O\+R\+T\+I\+ON.



Referenced by init\+\_\+slew().


\begin{DoxyCode}
31                    \{
32   \textcolor{comment}{//Take back half approach}
33   \textcolor{comment}{//Not linear but equal to setSpeed(1-(1/2)^x)}
34   \textcolor{keywordflow}{if}(mutexTake(\hyperlink{slew_8c_ae8b85b4f519a4945ba9ea43e9b503531}{mutex}, 10)) \{
35     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i = 0; i < \hyperlink{slew_8h_ad1ad4b29af4180aa00713599367fbc98}{MOTOR\_PORTS}; i++) \{
36       \textcolor{keywordtype}{char} set\_speed = \hyperlink{slew_8c_a3143c164339fd92b9b1e132c63a41060}{motors\_set\_speeds}[i];
37       \textcolor{keywordtype}{char} curr\_speed = motorGet(i);
38       \textcolor{keywordtype}{char} diff = set\_speed - curr\_speed;
39       \textcolor{keywordtype}{int} n = (int) curr\_speed + ceil(diff/(\textcolor{keywordtype}{float})\hyperlink{slew_8h_a4a3ff8667251227c99f8f4c81e9ff467}{RAMP\_PROPORTION});
40       \textcolor{keywordtype}{char} c[16];
41       sprintf(c, \textcolor{stringliteral}{"Set Motor %d: %d"}, i, n);
42       \hyperlink{log_8h_af3668f40d1ad1b4f3418869ac9a31f34}{debug}(c);
43       motorSet(i, n);
44     \}
45     mutexGive(\hyperlink{slew_8c_ae8b85b4f519a4945ba9ea43e9b503531}{mutex});
46   \}
47 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\mbox{\Hypertarget{slew_8c_aedeffc7d23da25d52b9a50045189fe2b}\label{slew_8c_aedeffc7d23da25d52b9a50045189fe2b}} 
\index{slew.\+c@{slew.\+c}!initialized@{initialized}}
\index{initialized@{initialized}!slew.\+c@{slew.\+c}}
\subsubsection{\texorpdfstring{initialized}{initialized}}
{\footnotesize\ttfamily bool initialized = false\hspace{0.3cm}{\ttfamily [static]}}



Boolean indicating whether or not the slew rate controller has been initialized. 

\begin{DoxyAuthor}{Author}
Chris Jerrett 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
9/14/17 
\end{DoxyDate}


Definition at line 29 of file slew.\+c.



Referenced by init\+\_\+slew().

\mbox{\Hypertarget{slew_8c_a3143c164339fd92b9b1e132c63a41060}\label{slew_8c_a3143c164339fd92b9b1e132c63a41060}} 
\index{slew.\+c@{slew.\+c}!motors\+\_\+set\+\_\+speeds@{motors\+\_\+set\+\_\+speeds}}
\index{motors\+\_\+set\+\_\+speeds@{motors\+\_\+set\+\_\+speeds}!slew.\+c@{slew.\+c}}
\subsubsection{\texorpdfstring{motors\+\_\+set\+\_\+speeds}{motors\_set\_speeds}}
{\footnotesize\ttfamily signed char$\ast$ motors\+\_\+set\+\_\+speeds = N\+U\+LL\hspace{0.3cm}{\ttfamily [static]}}



Array of motor speed values to set the motors to. 

\begin{DoxyAuthor}{Author}
Chris Jerrett 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
9/14/17 
\end{DoxyDate}


Definition at line 15 of file slew.\+c.



Referenced by deinitslew(), set\+\_\+motor\+\_\+slew(), and update\+Motors().

\mbox{\Hypertarget{slew_8c_ae8b85b4f519a4945ba9ea43e9b503531}\label{slew_8c_ae8b85b4f519a4945ba9ea43e9b503531}} 
\index{slew.\+c@{slew.\+c}!mutex@{mutex}}
\index{mutex@{mutex}!slew.\+c@{slew.\+c}}
\subsubsection{\texorpdfstring{mutex}{mutex}}
{\footnotesize\ttfamily Mutex mutex\hspace{0.3cm}{\ttfamily [static]}}



mutex to protect the data in the array of speeds from being read or written to simultaneously. 

\begin{DoxyAuthor}{Author}
Chris Jerrett 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
9/14/17 
\end{DoxyDate}


Definition at line 8 of file slew.\+c.



Referenced by init\+\_\+slew(), set\+\_\+motor\+\_\+slew(), and update\+Motors().

\mbox{\Hypertarget{slew_8c_a9dc30877eadbb32ceb6bede027c9a93f}\label{slew_8c_a9dc30877eadbb32ceb6bede027c9a93f}} 
\index{slew.\+c@{slew.\+c}!slew@{slew}}
\index{slew@{slew}!slew.\+c@{slew.\+c}}
\subsubsection{\texorpdfstring{slew}{slew}}
{\footnotesize\ttfamily Task\+Handle slew = N\+U\+LL\hspace{0.3cm}{\ttfamily [static]}}



Task that will handle updating the motors on a routine period. 

\begin{DoxyAuthor}{Author}
Chris Jerrett 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
9/14/17 
\end{DoxyDate}


Definition at line 22 of file slew.\+c.



Referenced by deinitslew(), and init\+\_\+slew().

