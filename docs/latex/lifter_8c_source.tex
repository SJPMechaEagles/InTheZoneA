\subsection{lifter.\+c}
\label{lifter_8c_source}\index{src/lifter.\+c@{src/lifter.\+c}}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#include "lifter.h"}
00002 
00010 \textcolor{keywordtype}{void} set_lifter_motors(\textcolor{keyword}{const} \textcolor{keywordtype}{int} v) \{
00011   set_motor_immediate(MOTOR_LIFT_TOP_RIGHT, -v);
00012   set_motor_immediate(MOTOR_LIFT_TOP_LEFT, -v);
00013 \}
00014 
00022 \textcolor{keywordtype}{void} set_lifter_pos(\textcolor{keywordtype}{int} pos) \{
00023 
00024 \}
00025 
00026 \textcolor{keywordtype}{void} raise_lifter()\{
00027   set_lifter_motors(MAX_SPEED);
00028 \}
00029 
00030 \textcolor{keywordtype}{void} lower_lifter()\{
00031   set_lifter_motors(MIN_SPEED);
00032 \}
00033 
00040 \textcolor{keywordtype}{void} update_lifter() \{
00041   \textcolor{comment}{//Establish variables to be used repeatedly}
00042   \textcolor{keyword}{static} \textcolor{keywordtype}{bool} changed = \textcolor{keyword}{true};
00043   \textcolor{keyword}{static} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} target = 0;
00044   \textcolor{keyword}{static} \textcolor{keywordtype}{bool} first\_run = \textcolor{keyword}{true};
00045   \textcolor{comment}{//Set the target to the current height for the first run}
00046   \textcolor{keywordflow}{if}(first\_run) \{
00047     target = getLifterTicks();
00048     first\_run = \textcolor{keyword}{false};
00049   \}
00050   \textcolor{comment}{//Establish the error as 0}
00051   \textcolor{keyword}{static} \textcolor{keywordtype}{int} last\_error = 0;
00052   \textcolor{keyword}{static} \textcolor{keywordtype}{long} \textcolor{keywordtype}{long} i = 0;
00053   \textcolor{comment}{//Check the buttons on the controller indicated by the controller mode}
00054   \textcolor{keywordflow}{if}((joystickGetDigital(LIFTER_UP) && get_mode() == MAIN_CONTROLLER_MODE)
00055    || (joystickGetDigital(LIFTER_UP_PARTNER) && get_mode() == 
      PARTNER_CONTROLLER_MODE))\{
00056     changed = \textcolor{keyword}{true};
00057     i = 0;
00058     \textcolor{comment}{//Change the target and start the motion}
00059     target = getLifterTicks() + 200;
00060     lower_lifter();
00061   \}
00062   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}((joystickGetDigital(LIFTER_DOWN) && get_mode() == MAIN_CONTROLLER_MODE)
00063    || (joystickGetDigital(LIFTER_DOWN_PARTNER) && get_mode() == 
      PARTNER_CONTROLLER_MODE)) \{
00064     changed = \textcolor{keyword}{true};
00065     i = 0;
00066     \textcolor{comment}{//Change the target and start the motion}
00067     target = getLifterTicks();
00068     raise_lifter();
00069   \}
00070   \textcolor{comment}{//Raise the lifter to the driver load height}
00071   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(joystickGetDigital(LIFTER_DRIVER_LOAD) && get_mode() == 
      MAIN_CONTROLLER_MODE)\{
00072     changed = \textcolor{keyword}{true};
00073     i = 0;
00074     \textcolor{keywordtype}{int} k = 0;
00075     \textcolor{keywordflow}{if}(getLifterTicks() < 1270)\{
00076       lower_lifter();
00077 
00078     \}
00079     \textcolor{keywordflow}{if}(getLifterTicks() > 1230)\{
00080       raise_lifter();
00081     \}
00082     target = 1250;
00083   \}
00084   \textcolor{comment}{//Change lifter motor values based upon the target}
00085   \textcolor{keywordflow}{else} \{
00086     \textcolor{comment}{//Don't if we are using the partner controller}
00087     \textcolor{keywordflow}{if}(get_mode() == PARTNER_CONTROLLER_MODE)\{
00088       set_lifter_motors(0);
00089       \textcolor{keywordflow}{return};
00090     \}
00091     \textcolor{comment}{//Define the proportion, derivative, and integral to be used in the motor speed}
00092     \textcolor{keywordtype}{int} p = getLifterTicks() - target;
00093     \textcolor{keywordtype}{int} d = p - last\_error;
00094     last\_error = p;
00095     i += p;
00096     \textcolor{keywordtype}{int} motor = LIFTER_P * p + LIFTER_D * d + LIFTER_I * i;
00097     \textcolor{comment}{//Avoid wasting battery if value is insignificant}
00098     \textcolor{keywordflow}{if} (motor < THRESHOLD) \{
00099         set_lifter_motors(0);
00100     \} \textcolor{keywordflow}{else} \{
00101         set_lifter_motors(motor);
00102     \}
00103 
00104   \}
00105 \}
00106 
00115 \textcolor{keywordtype}{float} lifterPotentiometerToDegree(\textcolor{keywordtype}{int} x)\{
00116   \textcolor{keywordflow}{return} (x - INIT_ROTATION) / TICK_MAX * DEG_MAX;
00117 \}
00118 
00126 \textcolor{keywordtype}{int} getLifterTicks() \{
00127   \textcolor{keywordflow}{return} analogRead(LIFTER);
00128 \}
00129 
00137 \textcolor{keywordtype}{double} getLifterHeight() \{
00138   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} ticks = getLifterTicks();
00139   \textcolor{keywordflow}{return} (-2 * pow(10, (-9 * ticks)) + 6 * (pow(10, (-6 * ticks * ticks))) + 0.0198 * ticks + 2.3033);
00140 \}
\end{DoxyCode}
